\documentclass[shownotes]{beamer}
\input{../../aux/tex/diapo_encabezado.tex}
\input{../../aux/tex/tikzlibrarybayesnet.code.tex}

\mode<presentation>
{
%   \usetheme{Madrid}      % or try Darmstadt, Madrid, Warsaw, ...
%   \usecolortheme{default} % or try albatross, beaver, crane, ...
%   \usefonttheme{default}  % or try serif, structurebold, ...
 \usetheme{Antibes}
 \usecolortheme[rgb={0.6,0.75,0}]{structure}%divido los RGB por 252
 \setbeamercolor{block title}{fg=white,bg=azuluca}
 \xdefinecolor{azuluca}{rgb}{0.02, 0.2, 0.18}
 \definecolor{greenblue}{rgb}{0.1, 0.55, 0.5}

 \setbeamercolor{palette quaternary}{fg=white,bg=azuluca}
 \setbeamertemplate{caption}[numbered]
 \setbeamercolor{item projected}{bg=black}
 \setbeamertemplate{enumerate items}[default]
 \setbeamertemplate{navigation symbols}{}
 %\setbeamercovered{transparent}
 \setbeamercolor{block title}{fg=black}
 \setbeamercolor{local structure}{fg=black}

}

\usepackage{todonotes}
\setbeameroption{show notes}

\title[Inferencia Bayesiana]{Seminario de Inferencia Bayesiana}

\institute[Bayes Buenos Aires]{\includegraphics[width=0.85\textwidth]{../../aux/static/peligro_predador}}
% 
% \author[Sorprea]{Sorpresa}

\date{\today}

\begin{document}

\small

\begin{frame}[noframenumbering]
 
 %\vspace{2cm}
\maketitle
 \end{frame}
 
\section{¿Qu\'e es la inferencia Bayesiana?}

\begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 \large ¿Qu\'e es la inferencia Bayesiana?
\end{center}
\end{textblock}

\vspace{0.75cm}
\pause

 \Wider[-1cm]{
 \begin{mdframed}[backgroundcolor=black!15]
\normalsize \centering
La forma \'optima de actualizar nuestras creencias 

dadas restricciones: modelos y datos
 \end{mdframed}
}

\begin{textblock}{128}(0,92)
\tiny \centering
Detalles en: \href{https://doi.org/10.1016/S0888-613X(03)00051-3}{Teorema de Cox}
\end{textblock}
 \end{frame}
 
 
% 
%  \begin{frame}
% \begin{textblock}{128}(0,8)
% \begin{center}
%  \large ¿Qu\'e es la inferencia Bayesiana?
% \end{center}
% \end{textblock}
% \vspace{0.75cm}
% 
% El \'unico razonamiento que permita trabajar con incertidumbre:
% 
% \vspace{1cm}
% 
% \footnotesize
% \begin{itemize} 
%  \item[$\textbf{R1}$] La creencia de $H$ dado $D$ se puede representar con un n\'umero real.% Existe un n\'umero $\bm{T}$ tal que such para cada $C(H|D)\leq \bm{T}$.
%  \item[$\textbf{R2}$] Es compatible con el razonamiento proposicional.
%  \item[$\textbf{R3}$] Existe una funci\'on equivalente a la negaci\'on% $f(c(H|D)) = c(\neg H|D)$
%  \item[$\textbf{R4}$] Creencias no relacionadas son independientes% $c(H_1|D)=c(H_1|H_2,D)$
%  \item[$\textbf{R5}$] Existe una funci\'on equivalente a la conjuci\'on% $c(H_1 \wedge H_2|D) = f(c(H_1|H_2,D)c(H_2|D))$
%  
% \end{itemize}
% 
% 
%  \end{frame}
% 
%  
\subsection{Las reglas de la probabilidad}

\begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 \large Las reglas de la probabilidad
\end{center}
\end{textblock}


\vspace{0.75cm}



\begin{equation*}
  \text{Marginal}_{i} = \sum_j \text{Conjunta}_{ij}  \ \ \ \ \ \ \ \ \ \ \ \  \text{Condicional}_{j|i} = \frac{\text{Conjunta}_{ij}}{\text{Marginal}_{i}}
\end{equation*}

\pause
\vspace{0.75cm}


\begin{columns}[t]
\begin{column}{0.5\textwidth}
 \centering \textbf{Regla de la suma}
 
 
\begin{equation*}
 P(X) = \sum_Y P(X,Y)
\end{equation*}
 
 \justifying \footnotesize
  Cualquier distribución marginal puede ser obtenida integrando la distribución conjunta

 \end{column}
 \begin{column}{0.5\textwidth}
\centering  \textbf{Regla del producto}

\begin{equation*}
 P(X,Y) = P(Y|X) P(X)
\end{equation*}

 \justifying \footnotesize
Cualquier distribución conjunta puede ser expresada como el producto de distribuciones condicionales uni-dimensionles.

\end{column}
\end{columns}

\end{frame}

 \section{Actualizaci\'on de creencias}
 
 \begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 \large Actualizaci\'on de creencias.
 \end{center}
\end{textblock}

 
 
\only<1>{
\begin{textblock}{128}(0,37.75)
\begin{equation*}
\underbrace{P(\text{Hip\'otesis }|\text{ Datos})}_{\text{\scriptsize Posteriori}} = \frac{\overbrace{P(\text{Datos }|\text{ Hip\'otesis})}^{\text{\scriptsize Verosimilitud}} \overbrace{P(\text{Hip\'otesis})}^{\text{\scriptsize Priori}} }{\underbrace{P(\text{Datos})}_{\text{\scriptsize Evidencia}}}
\end{equation*}
\end{textblock}

}

\only<2>{  
\Wider[2cm]{
\begin{textblock}{128}(0,34.25)
\begin{equation*}
\underbrace{P(\text{Hip\'otesis }|\text{ Datos, Modelo})}_{\text{\scriptsize Posteriori}} = \frac{\overbrace{P(\text{Datos }|\text{ Hip\'otesis, Modelo})}^{\text{\scriptsize Verosimilitud}} \overbrace{P(\text{Hip\'otesis }|\text{ Modelo})}^{\text{\scriptsize Priori}} }{\underbrace{P(\text{Datos }|\text{ Modelo})}_{\text{\scriptsize Evidencia}}}
\end{equation*}
\end{textblock}
}
}
\end{frame}

\subsection{Modelos}

\begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 \Large Actualizaci\'on de creencias. \\
 \large Modelos
\end{center}
\end{textblock}


 \begin{center}
 \large ¿Y nuestras creencias respecto de modelos alternativos?  
 \end{center}


\end{frame}


\begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 \Large Actualizaci\'on de creencias. \\
 \large Modelos
\end{center}
\end{textblock}


\only<1>{
\begin{textblock}{128}(0,34) 
\begin{equation*}
 P(\text{Modelo}|\text{Datos}) = \frac{P(\text{Datos}|\text{Modelo})P(\text{Modelo})}{ P(\text{Datos})}
\end{equation*}
\end{textblock}
}

\only<2>{
\begin{textblock}{128}(0,34)
\begin{equation*}
   \frac{P(\text{Modelo}_i|\text{Datos})}{P(\text{Modelo}_j|\text{Datos})}  = \frac{P(\text{Datos}|\text{Modelo}_i)\,\,P(\text{Modelo}_i)}{P(\text{Datos}|\text{Modelo}_j)\,\,P(\text{Modelo}_j)}  
\end{equation*}
\end{textblock}
}
\only<3>{
\begin{textblock}{128}(0,34)
\begin{equation*}
 \frac{P(\text{Modelo}_i|\text{Datos})}{P(\text{Modelo}_j|\text{Datos})}  = \frac{P(\text{Datos}|\text{Modelo}_i)\,\,P(\text{Modelo}_i)}{ \underbrace{P(\text{Datos}|\text{Modelo}_j)}_{\text{Evidencia!}}\,P(\text{Modelo}_j)}
\end{equation*}
\end{textblock}
}

\only<4->{
\begin{textblock}{128}(0,34)
\begin{equation*}
  \frac{P(\text{Modelo}_i|\text{Datos})}{P(\text{Modelo}_j|\text{Datos})}  = \frac{P(\text{Datos}|\text{Modelo}_i)\,\,P(\text{Modelo}_i)}{ \underbrace{P(\text{Datos}|\text{Modelo}_j)}_{\text{Evidencia!}}\, \underbrace{P(\text{Modelo}_j)}_{\text{Escalar } k } }
\end{equation*}
\end{textblock}
}

\only<5>{
\begin{textblock}{128}(0,48) 
\begin{equation*}
P(\text{Datos}|\text{Modelo}) = \sum_{h}^H P(\text{Datos}|\text{Hip\'otesis}=h,\text{Modelo}) P(\text{Hip\'otesis}=h|\text{Modelo}) 
\end{equation*}
\end{textblock}
}

\only<6->{
\begin{textblock}{128}(0,48) 
\begin{equation*}
\begin{split}
P(\text{Datos}|\text{Modelo}) &= \sum_{h}^H P(\text{Datos}|\text{Hip\'otesis}=h,\text{Modelo}) P(\text{Hip\'otesis}=h|\text{Modelo}) 
\\
& = P(\text{D}_1|\text{M}) P(\text{D}_2|\text{D}_1, \text{M}) \dots P(\text{D}_N|\text{D}_{N-1} \dots \text{D}_1, \text{M})  
\end{split} 
\end{equation*}
\end{textblock}
}


\only<7>{
\begin{textblock}{108}(10,74)
\begin{mdframed}[backgroundcolor=black!15]
\footnotesize \centering Preferimos modelos con la \textbf{menor sorpresa conjunta}!
\end{mdframed}
% \vspace{-0.25cm}
% \onslide<7->{
% \begin{mdframed}[backgroundcolor=black!15]
% \centering
% $P(M_q|D) > P(M_r|D) \Longleftrightarrow P(D|M_q) > P(D|M_r)$ 
% \end{mdframed}}
 \end{textblock} 
}
 

\only<7>{
\begin{textblock}{128}(0,92)
\centering \tiny Sobre comparaci\'on de modelos ver: \href{http://xyala.cap.ed.ac.uk/teaching/tutorials/phylogenetics/Bayesian_Workshop/PDFs/Kass\%20and\%20Raftery\%201995.pdf}{Kass \& Raftery. Bayes factors. 1995.}
\end{textblock}
}
\end{frame}

\section{Sorpresa}


\begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 \Large Sorpresa
\end{center}
\end{textblock}
\vspace{0.75cm}
\includegraphics[width=1\textwidth]{../../aux/static/peligro_predador}
\end{frame}


\subsection{Modelos lineales}

\begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 \large Modelos lineales
\end{center}
\end{textblock}
 \vspace{0.75cm}
 
\begin{equation*}
y(\bm{x},\bm{w}) = \sum_{i=0}^{M-1} w_i \phi_i(\bm{x}) = \bm{w}^T \bm{\phi}(\bm{x})
\end{equation*}

\vspace{0.5cm}
\pause
% 
% \begin{equation*}
%  t = y(\vm{x},\vm{w}) + \epsilon  \ \ \ \ \  \text{con} \ \ \  \epsilon \sim \N(0,\beta^{-1})
% \end{equation*}
 
 \begin{equation*}
P(t | \bm{x}, \bm{w}, \beta) = \N(t | y(\bm{x},\bm{w}) , \beta^{-1})
\end{equation*}
\vspace{0.025cm}
\pause
 
\begin{equation*}
P(\bm{t} | \bm{x}, \bm{w}, \beta) = \prod_{i=1}^n \N(t_i | \bm{w}^T \bm{\phi}(\bm{x}_i) , \beta^{-1}) = \N(\bm{t}|\bm{w}^T \bm{\Phi}, \beta^{-1} \vm{I})
\end{equation*}
\vspace{0.05cm}
\pause

\begin{equation*}
 \bm{\Phi} =
  \begin{pmatrix}
    \phi_0(\bm{x}_1) & \phi_1(\bm{x}_1) & \dots & \phi_{M-1}(\bm{x}_1)\\
    \vdots & \vdots & \ddots & \vdots \\
    \phi_0(\bm{x}_N) & \phi_1(\bm{x}_N) & \dots & \phi_{M-1}(\bm{x}_N)
  \end{pmatrix}
  = 
  \begin{pmatrix}
   \bm{\phi}(\vm{x}_1)^T \\
   \vdots \\
   \bm{\phi}(\vm{x}_N)^T \\
  \end{pmatrix}
\end{equation*}

 
\end{frame}



\begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 \normalsize Soluci\'on puntual
\end{center}
\end{textblock}
 \vspace{0.75cm}


\begin{equation*}
 \underset{\bm{w}}{\text{ max }} P(\bm{t} | \bm{x}, \bm{w}, \beta) = \underset{\bm{w}}{\text{ min }} \sum_{i=1}^{n}  (t_i - \bm{w}^T\bm{\phi}(\bm{x}_i))^2 
\end{equation*}

\end{frame}


\begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 \normalsize Soluci\'on completa
\end{center}
\end{textblock}
 \vspace{0.75cm}

\begin{equation*}
 p(\vm{w}) = N(\vm{w}| \vm{0}, \alpha^{-1} \vm{I})
\end{equation*}
 
\begin{figure}[H]
    \centering
    \tikz{

    \node[latent, fill=black!100, minimum size=2pt] (x) {} ; %
    \node[const, right=of x] (c_x) {$\vm{X}$};
    \node[latent, fill=black!20, yshift=-1.5cm] (t) {$\bm{t}$} ; %
    \node[latent, fill=black!100, yshift=-1.5cm , xshift=-2cm,minimum size=2pt] (beta)
    {} ; %
    \node[const, above=of beta] (c_beta) {$\beta$};
    \node[latent, fill=black!0, yshift=-1.5cm, xshift=2cm] (w) {$\vm{w}$};
    \node[latent, fill=black!100, xshift=2cm, minimum size=2pt] (alpha) {} ; %
    \node[const, right=of alpha] (c_alpha) {$\alpha$};
    
    \edge {x,beta,w} {t};
    \edge {alpha} {w};
    
    \node[invisible, fill=black!0, minimum size=0pt, xshift=-0.52cm] (data_inv) {} ; %
      
    }  
\end{figure}
\end{frame}


\begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 \normalsize Soluci\'on completa
\end{center}
\end{textblock}
 \vspace{0.75cm}



 La distribuci\'on \textbf{posteriori} sobre $\vm{w}$ tiene como media

\begin{equation}
 \vm{m}_N = \beta  \vm{S}_N\vm{\Phi}^T \vm{t}
\end{equation}

y como covarianzas

\begin{equation}
 \vm{S}_N^{-1} = \alpha \vm{I} + \beta \vm{\Phi}^T\vm{\Phi}
\end{equation}

\pause


Y la \textbf{evidencia} del modelo es

\begin{equation}
 P(t) = \N(\bm{t}| \vm{0}, \beta^{-1} \vm{I} + \alpha^{-1}\bm{\Phi}\bm{\Phi}^T  )
\end{equation}


\end{frame}


\begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 \normalsize Propiedades importantes para la vida
\end{center}
\end{textblock}
\vspace{0.75cm}

\tiny

Dadas las distribuciones
\begin{align*}
    P(\vm{x}) &=  \N(\vm{x}|\bm{\mu},\bm{\Lambda}^{-1}) \\
   P(\vm{y}|\vm{x}) &=  \N(\vm{y}|\vm{A}\vm{x}+\vm{b},\vm{L}^{-1})    
\end{align*}


 Luego,  
\begin{align*}
    P(\vm{y}) &=  \N(\vm{y}|\vm{A}\bm{\mu}+\vm{b},\, \vm{L}^{-1} + \vm{A}\vm{\Lambda}^{-1}\vm{A}^T) \\
   P(\vm{x}|\vm{y}) &=  \N(\vm{x}|\vm{\Sigma}[\vm{A}^T \vm{L}(\vm{y}-\vm{b})+ \bm{\Lambda\mu}],\,  \vm{\Sigma})\label{eq:post}
\end{align*}

donde, 
\begin{equation*}
 \vm{\Sigma} = (\vm{\Lambda} + \vm{A}^T \vm{LA} )^{-1}
\end{equation*}

\vspace{0.3cm}

\small
\begin{mdframed}[backgroundcolor=black!15]\centering
 Leer cap\'itulo 2 de Bishop y/o anexo de la pr\'actica
\end{mdframed}

\end{frame}


\begin{frame}

\vspace{-1cm}
 \begin{figure}

\begin{subfigure}[t]{0.32\textwidth} 
\caption*{Verosimilitud} 
\end{subfigure}
\begin{subfigure}[t]{0.32\textwidth}
\caption*{Priori/Posteriori} 
\includegraphics[width=\textwidth]{../../figures/linearRegression_posterior_0.pdf} 
\end{subfigure}
\begin{subfigure}[t]{0.32\textwidth}
\caption*{Data space} 
\includegraphics[width=\textwidth]{../../figures/linearRegression_dataSpace_0.pdf} 
\end{subfigure}


\begin{subfigure}[c]{0.32\textwidth}
\includegraphics[width=\textwidth]{../../figures/linearRegression_likelihood_1.pdf} 
\end{subfigure}
\begin{subfigure}[c]{0.32\textwidth}
\includegraphics[width=\textwidth]{../../figures/linearRegression_posterior_1.pdf} 
\end{subfigure}
\begin{subfigure}[c]{0.32\textwidth}
\includegraphics[width=\textwidth]{../../figures/linearRegression_dataSpace_1.pdf} 
\end{subfigure}

\begin{subfigure}[c]{0.32\textwidth}
\includegraphics[width=\textwidth]{../../figures/linearRegression_likelihood_2.pdf} 
\end{subfigure}
\begin{subfigure}[c]{0.32\textwidth}
\includegraphics[width=\textwidth]{../../figures/linearRegression_posterior_2.pdf} 
\end{subfigure}
\begin{subfigure}[c]{0.32\textwidth}
\includegraphics[width=\textwidth]{../../figures/linearRegression_dataSpace_2.pdf} 
\end{subfigure}

\end{figure}

\end{frame}


\subsection{Regresion lineal Bayesiana}

\begin{frame}
\begin{textblock}{108}(10,08)
 \begin{center}
  \large Regresi\'on lineal Bayesiana
 \end{center}
\end{textblock}


\begin{textblock}{64}(0,28)
 \centering
 \onslide<1->{Funci\'on objetivo}
\end{textblock}

\begin{textblock}{64}(64,28)
 \centering
 \onslide<2>{Modelos polinomiales}
\end{textblock}

\begin{textblock}{128}(0,32)
     \centering 
       \onslide<1->{\includegraphics[width=0.48\textwidth]{../../figures/model_selection_true_and_sample} }
       \onslide<2>{\includegraphics[width=0.48\textwidth]{../../figures/model_selection_MAP} }
\end{textblock}

\end{frame}

\begin{frame}
\begin{textblock}{128}(0,8)
\begin{center}
 Evidencia vs Verosimilitud
\end{center}
\end{textblock}



\begin{textblock}{64}(0,28)
 \centering
Evidencia conjunta
\end{textblock}

\begin{textblock}{64}(64,28)
 \centering
 M\'axima verosimilitud
\end{textblock}


\begin{textblock}{128}(0,30)
     \centering 
       \begin{figure}[H]     
     \centering 
     \begin{subfigure}[b]{0.47\textwidth}
       \includegraphics[width=1\textwidth]{../../figures/model_selection_evidence}
     \end{subfigure}
     \begin{subfigure}[b]{0.49\textwidth}
       \includegraphics[width=1\textwidth]{../../figures/model_selection_maxLikelihood}
     \end{subfigure}
\end{figure}
\end{textblock}


\end{frame}



\section{Evidencia}

%
% \begin{frame}
%  \begin{textblock}{108}(10,08)
%  \begin{center}
%   \large Evidencia
%  \end{center}
% \end{textblock}
% 
% \begin{textblock}{108}(10,22)
% \begin{align*}
%  P(\text{C}|\text{D},\text{M}) = \frac{P(\text{D}|\text{C},\text{M})P(\text{C}|\text{M})}{\underbrace{P(\text{D}|\text{M})}_{\text{Evidencia}}}
% \end{align*}
% \end{textblock}
% 
% 
% 
% \only<2>{
% \begin{textblock}{108}(10,44)
% \begin{align*}
%  P(\text{D}|\text{M}) = \sum_C P(\text{D}|\text{C},\text{M})\, P(\text{C}|\text{M})
% \end{align*}
% \end{textblock}
% 
% }
% 
% 
% \only<3>{
% \begin{textblock}{108}(10,44)
% \begin{align*}
%  P(\text{D}|\text{M}) = \sum_C \underbrace{P(\text{D}|\text{C},\text{M})}_{\hfrac{\text{\tiny Predicci\'on}}{\text{\tiny de D dado C}}}\underbrace{P(\text{C}|\text{M})}_{\hfrac{\text{\tiny Creencia de}}{\text{\tiny C a Priori}}} %\text{La predicci\'on de los datos observados a partir de las creencias a priori}
% \end{align*}
% \end{textblock}
% 
% }
% 
% \only<4->{
% \begin{textblock}{108}(10,44)
% \begin{align*}
%  P(\text{D}|\text{M}) = \underbrace{ \sum_C \underbrace{P(\text{D}|\text{C},\text{M})}_{\hfrac{\text{\tiny Predicci\'on}}{\text{\tiny de D dado C}}}\underbrace{P(\text{C}|\text{M})}_{\hfrac{\text{\tiny Creencia de}}{\text{\tiny C a Priori}}}}_{\hfrac{\text{\tiny Predicci\'on de la datos observados}}{\text{\tiny pesando todas las creencias a priori}}}
% \end{align*}
% \end{textblock}
% }
% 
% 
% 
% 
% \end{frame}



\begin{frame}
\begin{textblock}{108}(10,08)
 \begin{center}
  \Large  Evidencia
 \end{center}
\end{textblock}


 \begin{textblock}{102}(10,22)
  \centering
  \includegraphics[width=0.9\textwidth]{../../figures/evidencia_de_modelos_alternativos} 
 \end{textblock} 
 
 
 \begin{textblock}{88}(20,80)
  \begin{mdframed}[backgroundcolor=black!15]
\centering
  Balance natural entre complejidad y predicci\'on
  \end{mdframed}
 \end{textblock}
\end{frame}

\subsection{Ejemplos de evaluaci\'on de modelo}
\begin{frame}
\begin{textblock}{108}(10,08)
 \begin{center}
  \large Ejemplos de evaluaci\'on de modelo
 \end{center}
\end{textblock}
 
\begin{itemize}
 \item[$\bullet$] \href{https://papers.nips.cc/paper/3331-trueskill-through-time-revisiting-the-history-of-chess.pdf}{TrueSkill Through Time:Revisiting the History of Chess} \pause
 \item[$\bullet$] \href{https://arxiv.org/pdf/1906.04652.pdf}{Ergodicity-breaking reveals time optimal economic behavior in humans} \pause
 \item[$\bullet$] \href{https://web.mit.edu/cocosci/Papers/pos785-goodman.pdf}{Intuitive Theories of Mind: A Rational Approach to False Belief}
\end{itemize}
 
\end{frame}










\begin{frame}[plain]

\centering
  \includegraphics[width=0.55\textwidth]{../../aux/static/pachacuteckoricancha.jpg}
\end{frame}





\end{document}



